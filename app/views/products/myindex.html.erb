<%=render 'sell_and_buy/snb_category'%>

<div id="content">
    <!-- sell_list 김수겸 14.09.24 -->
    <div class="sell_list">
      <div class="sell_list_head">
        <div class="logo"><h1>상품관리</h1></div>
      </div>
      <div class="sell_list_body">
        <div class="row">
          <div class="col-lg-12">
            <div class="panel panel-default">
              <div class="panel-heading">판매목록</div>
              <div class="panel-body">
                <div class="table-responsive">
                  <table class="table table-striped table-bordered table-hover"
                  id="dataTables">
                  <thead>
                    <tr>
                      <th>상품번호</th>
                      <th>상품명</th>
                      <th>상품내용</th>
                      <th>가격</th>
                      <th>카테고리</th>
                      <th>등록일자</th>
                      <th>수정일자</th>
                      <th>이미지</th>
                    </tr>
                  </thead>
                  
                  <tbody>
                    <tr>
                      <td>상품번호</td>
                      <td>상품명</td>
                      <td>상품내용</td>
                      <td>가격</td>
                      <td>카테고리</td>
                      <td>등록일자</td>
                      <td>수정일자</td>
                      <td>이미지</td>
                    </tr>
                  </tbody>

                  <tfoot>
                    <tr>
                      <th>상품번호</th>
                      <th>상품명</th>
                      <th>상품내용</th>
                      <th>가격</th>
                      <th>카테고리</th>
                      <th>등록일자</th>
                      <th>수정일자</th>
                      <th>이미지</th>
                    </tr>
                    <tr>
                      <th colspan="3" style="text-align:right">합계:</th>
                      <th colspan="5" style="text-align:left" id="all_price_total"></th>
                    </tr>
                  </tfoot>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- sell_list end -->
  </div>
</div>
<!-- sell_list js 김수겸 14.09.24 -->
<script type="text/Javascript">
var sell_list = function() {
  $('#dataTables')
  .DataTable(
  {
    "lengthMenu" : [ [ 10, 25, 50, 75, -1 ],
    [ 10, 25, 50, 75, "All" ] ],/*
    "ajax" : "/products.json",
    "columns" : [ {
      "title" : "상품번호",
      "data" : "id"
    }, {
      "title" : "상품명",
      "data" : "name"
    }, {
      "title" : "상품내용",
      "data" : "content"
    }, {
      "title" : "가격",
      "data" : "price"
    },  {
      "title" : "카테고리",
      "data" : "category"
    },{
      "title" : "등록일자",
      "data" : "created_at"
    },{
      "title" : "수정일자",
      "data" : "updated_at"
    },{
      "title" : "이미지",
      "data" : "picture"
    }],*/
    "stateSave" : true,
    initComplete : function() {
      var api = this.api();

      api.columns().indexes().flatten().each(function(i) {
        var column = api.column(i);
        var title = '선택'/*$('#dataTables tfoot th').eq($(this).index()).text()*/;
        var select = $('<select><option value="">-'+ title+'-</option></select>').appendTo($(column             .footer()).empty()).on('change',function() {
          var val = $(this).val();
          column.search(val ? '^'+val + '$' : '',true,false).draw();
        });
        column.data().unique().sort().each(function(d,j) {
          select.append('<option value="'+d+'">' + d  + '</option>')
        });
      });
    },
    "footerCallback": function ( row, data, start, end, display ) {
      var api = this.api(), data;

            // Remove the formatting to get integer data for summation
            var intVal = function ( i ) {
              return typeof i === 'string' ?
              i.replace(/[\$,]/g, '')*1 :
              typeof i === 'number' ?
              i : 0;
            };

            // Total over all pages
            data = api.column( 3 ).data();
            total = data.length ?
            data.reduce( function (a, b) {
              return intVal(a) + intVal(b);
            } ) :
            0;

            // Total over this page
            data = api.column( 3, { page: 'current'} ).data();
            pageTotal = data.length ?
            data.reduce( function (a, b) {
              return intVal(a) + intVal(b);
            } ) :
            0;

            // Update footer
            $('#all_price_total').html(
              number_format(pageTotal)+'원'+' ( '+ number_format(total)+'원' +' 총 합계)'
              );
            function number_format(str1) {
            return str1.toString().replace(
                /(\-?\d+)(\d{3})($|\.\d+)/,
                function(str, p1, p2, p3) {
                  return number_format(p1) + "," + p2 + ""
                      + p3;
                });
          }
          }
        });
}
$(document).ready(sell_list);
$(document).on('page:change', sell_list);

    /*  var sell_list = function() {
          var table = $('#dataTables').DataTable({
              "lengthMenu" : [[10, 25, 50, 75, -1], [10, 25, 50, 75, "All"]],                     
              "ajax": "products.json"
              ,
              "columns" : [{
                  "title" : "상품명",
                  "data" : "id"
              },{
                  "title" : "상품명",
                  "data" : "name"
              }, {
                  "title" : "가격",
                  "data" : "price"
              }],
              "stateSave" : true
          });

          $("#dataTables tfoot th").each(function(i) {
              var title = $('#dataTables thead th').eq( $(this).index() ).text();
              var select = $('<select><option value="">-'+title+'-</option></select>').appendTo($(this).empty()).on('change', function() {
                  var val = $(this).val();

                  table.column(i).search( val ? '^' + $(this).val() + '$' : val, true, false).draw();
              });

              table.column(i).data().unique().sort().each(function(d, j) {
                  select.append('<option value="' + d + '">' + d + '</option>')
              });
          });
      };
      $(document).ready(sell_list);
      $(document).on('page:change', sell_list);*/
      </script>
      <!-- sell_list js end -->



